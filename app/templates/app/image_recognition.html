{% extends 'app/base.html' %}
{% load static %}

{% block title %}Real-time Currency Recognition - Cash Scan Explore{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/styles/image_recognition.css' %}">
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <h1 class="page-title">Real-time Currency Recognition</h1>
    
    <div class="recognition-container">
        <!-- Exchange rate display -->
        <div id="rateDisplay"></div>

        <!-- Camera Section -->
        <div class="camera-section">
            <h2>Real-time Camera Analysis</h2>
            <div class="controls">
                <select id="cameraSelect">
                    <option value="">Select a camera</option>
                </select>
                <button id="startButton" onclick="toggleCamera()">Start Camera</button>
            </div>

            <div class="video-container">
                <div class="video-box">
                    <h3>Camera Feed</h3>
                    <video id="video_preview" autoplay playsinline></video>
                </div>
                <div class="video-box">
                    <h3>Recognition Results</h3>
                    <img id="processed_video">
                </div>
            </div>

            <!-- Camera Detection Results -->
            <div class="camera-detection-results">
                <div class="money-counter">
                    <div>Total Amount (JPY): <span id="cameraJpyTotal">0</span> JPY</div>
                    <div>Total Amount (TWD): <span id="cameraTwdTotal">0</span> TWD</div>
                </div>
                <div id="cameraConversionResults"></div>
                <div class="detected-items" id="cameraDetectedItems"></div>
            </div>
        </div>

        <!-- Image Upload Section -->
        <div class="upload-section">
            <h2>Image Upload Analysis</h2>
            <div class="upload-container">
                <div class="upload-box" id="dropZone">
                    <input type="file" id="fileInput" accept="image/*" hidden>
                    <div class="upload-content">
                        <i class="upload-icon">ðŸ“¸</i>
                        <p>Drag and drop an image or click to upload</p>
                    </div>
                </div>
                <div class="preview-box">
                    <img id="imagePreview" alt="Preview">
                    <div class="analysis-results" id="imageAnalysisResults"></div>
                </div>
            </div>

            <!-- Image Detection Results -->
            <div class="image-detection-results">
                <div class="money-counter">
                    <div>Total Amount (JPY): <span id="imageJpyTotal">0</span> JPY</div>
                    <div>Total Amount (TWD): <span id="imageTwdTotal">0</span> TWD</div>
                </div>
                <div id="imageConversionResults"></div>
                <div class="detected-items" id="imageDetectedItems"></div>
            </div>
        </div>

        <!-- Error messages -->
        <div id="errorMessage"></div>
    </div>
    
    <!-- Hidden canvas -->
    <canvas id="canvas"></canvas>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'app/scripts/image_recognition.js' %}"></script>
{% endblock %}